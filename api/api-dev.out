
> api@0.1.0 dev /Users/dmitrii.malakhov/git/evm/api
> tsx watch src/index.ts

API server listening on http://0.0.0.0:4000
[0mPOST /auth/login [32m200[0m 7.157 ms - 128[0m
[0mGET /me [36m304[0m 1.034 ms - -[0m
[0mGET /features [36m304[0m 0.474 ms - -[0m
[0mGET /teams/t1 [36m304[0m 0.936 ms - -[0m
[0mGET /teams/t1/chat [36m304[0m 2.507 ms - -[0m
[0mGET /teams/t1 [36m304[0m 1.231 ms - -[0m
[0mGET /teams/t1/ideas [36m304[0m 2.689 ms - -[0m
[0mGET /teams/t1/progress [32m200[0m 0.574 ms - 127[0m
[0mGET /levels/current [33m404[0m 0.951 ms - 63[0m
[0mGET /teams/t1/ideas [36m304[0m 0.457 ms - -[0m
[0mGET /teams/t1/chat [36m304[0m 0.574 ms - -[0m
[0mGET /levels/current [33m404[0m 0.802 ms - 63[0m
[0mGET /teams/t1/progress [36m304[0m 0.317 ms - -[0m
[0mGET /teams/t1 [36m304[0m 0.367 ms - -[0m
[0mGET /teams/t1/chat [36m304[0m 0.956 ms - -[0m
[0mGET /teams/t1/ideas [36m304[0m 2.366 ms - -[0m
[0mGET /teams/t1/progress [36m304[0m 0.436 ms - -[0m
[0mGET /teams/t1 [36m304[0m 0.328 ms - -[0m
[0mGET /teams/t1/chat [36m304[0m 0.521 ms - -[0m
[0mGET /teams/t1/ideas [36m304[0m 0.705 ms - -[0m
[0mGET /teams/t1/progress [36m304[0m 0.542 ms - -[0m
[0mGET /feed [36m304[0m 0.963 ms - -[0m
[0mGET /feed [36m304[0m 0.478 ms - -[0m
[0mGET /feed [36m304[0m 0.241 ms - -[0m
[0mGET /feed [36m304[0m 0.381 ms - -[0m
[0mGET /feed [36m304[0m 0.208 ms - -[0m
[0mGET /feed [36m304[0m 0.237 ms - -[0m
[0mGET /tickets/me [36m304[0m 1.859 ms - -[0m
[0mGET /tickets/me [36m304[0m 0.921 ms - -[0m
[0mGET /feed [36m304[0m 0.526 ms - -[0m
[0mGET /feed [36m304[0m 0.582 ms - -[0m
[0mGET /feed [36m304[0m 0.336 ms - -[0m
[0mGET /feed [36m304[0m 0.802 ms - -[0m
[0mGET /feed [36m304[0m 0.806 ms - -[0m
[0mGET /feed [36m304[0m 0.472 ms - -[0m
[0mGET /teams/t1 [36m304[0m 0.388 ms - -[0m
[0mGET /teams/t1 [36m304[0m 0.409 ms - -[0m
[0mGET /teams/t1/chat [36m304[0m 0.847 ms - -[0m
[0mGET /teams/t1/ideas [36m304[0m 0.499 ms - -[0m
[0mGET /teams/t1/progress [36m304[0m 0.179 ms - -[0m
[0mGET /teams/t1/chat [36m304[0m 0.176 ms - -[0m
[0mGET /teams/t1/ideas [36m304[0m 0.864 ms - -[0m
[0mGET /teams/t1/progress [36m304[0m 0.274 ms - -[0m
[0mGET /feed [36m304[0m 0.420 ms - -[0m
[0mGET /feed [36m304[0m 0.415 ms - -[0m
[0mGET /feed [36m304[0m 0.686 ms - -[0m
[0mGET /feed [36m304[0m 0.215 ms - -[0m
[0mGET /feed [36m304[0m 0.176 ms - -[0m
[0mGET /feed [36m304[0m 0.255 ms - -[0m
[0mGET /tickets/me [36m304[0m 0.879 ms - -[0m
[0mGET /tickets/me [36m304[0m 0.535 ms - -[0m
[0mGET /levels/week/3 [33m404[0m 1.289 ms - 46[0m
[0mGET /levels/week/3 [33m404[0m 0.398 ms - 46[0m
[0mGET /teams/t1/chat [36m304[0m 0.395 ms - -[0m
[0mGET /teams/t1 [36m304[0m 0.136 ms - -[0m
[0mGET /teams/t1/progress [36m304[0m 0.897 ms - -[0m
[0mGET /teams/t1/ideas [36m304[0m 0.526 ms - -[0m
[0mGET /teams/t1/progress [36m304[0m 0.397 ms - -[0m
[0mGET /teams/t1/ideas [36m304[0m 0.998 ms - -[0m
[0mGET /teams/t1 [36m304[0m 0.326 ms - -[0m
[0mGET /teams/t1/chat [36m304[0m 0.243 ms - -[0m
[0mPOST /auth/login [32m200[0m 0.928 ms - 128[0m
[0mPOST /teams/t1/ideas/f01344d5-2ab3-48c6-bdd3-0f25fbb65429/vote [33m401[0m 0.830 ms - 66[0m
[0mPOST /teams/t1/ideas/f01344d5-2ab3-48c6-bdd3-0f25fbb65429/vote [33m401[0m 1.085 ms - 66[0m
[0mPOST /auth/login [32m200[0m 4.519 ms - 128[0m
[0mGET /me [36m304[0m 0.719 ms - -[0m
[0mGET /features [36m304[0m 0.328 ms - -[0m
[0mGET /teams/t1/ideas [36m304[0m 1.620 ms - -[0m
[0mGET /teams/t1 [36m304[0m 0.376 ms - -[0m
[0mGET /teams/t1/chat [36m304[0m 0.535 ms - -[0m
[0mGET /teams/t1/ideas [367:01:01 PM [tsx] change in ./src/services/levels.ts Rerunning...
c/Users/dmitrii.malakhov/git/evm/api/node_modules/.pnpm/drizzle-orm@0.44.7_better-sqlite3@11.10.0/node_modules/src/sqlite-core/session.ts:271
			throw new DrizzleError({ cause: err, message: `Failed to run the query '${staticQuery.sql}'` });
			      ^


DrizzleError: Failed to run the query 'CREATE TABLE IF NOT EXISTS `iterations` (
  `id` text PRIMARY KEY NOT NULL,
  `name` text NOT NULL,
  `starts_at` integer NOT NULL,
  `ends_at` integer NOT NULL,
  `total_weeks` integer NOT NULL DEFAULT 6,
  `current_week` integer NOT NULL DEFAULT 1
);

ALTER TABLE `levels` ADD COLUMN `iteration_id` text REFERENCES `iterations`(`id`) ON DELETE SET NULL;

DROP INDEX IF EXISTS `levels_week_idx`;
CREATE UNIQUE INDEX IF NOT EXISTS `levels_iteration_week_idx` ON `levels` (`iteration_id`, `week`);

ALTER TABLE `team_progress` ADD COLUMN `total_points` integer NOT NULL DEFAULT 0;
ALTER TABLE `team_progress` ADD COLUMN `completed_weeks` text NOT NULL DEFAULT '[]';
ALTER TABLE `team_progress` ADD COLUMN `weekly_stats` text NOT NULL DEFAULT '[]';

CREATE TABLE IF NOT EXISTS `user_week_progress` (
  `id` text PRIMARY KEY NOT NULL,
  `user_id` text NOT NULL,
  `iteration_id` text NOT NULL,
  `week` integer NOT NULL,
  `completed_tasks` text NOT NULL DEFAULT '[]',
  `points_earned` integer NOT NULL DEFAULT 0,
  `is_completed` integer NOT NULL DEFAULT 0,
  `finished_at` integer,
  `key_id` text,
  `title` text,
  FOREIGN KEY (`user_id`) REFERENCES `users`(`id`) ON DELETE CASCADE,
  FOREIGN KEY (`iteration_id`) REFERENCES `iterations`(`id`) ON DELETE CASCADE
);

CREATE UNIQUE INDEX IF NOT EXISTS `user_week_iteration_idx` ON `user_week_progress` (`user_id`, `iteration_id`, `week`);
'
    at BetterSQLiteSession.run (/Users/dmitrii.malakhov/git/evm/api/node_modules/.pnpm/drizzle-orm@0.44.7_better-sqlite3@11.10.0/node_modules/src/sqlite-core/session.ts:271:10)
    at SQLiteSyncDialect.migrate (/Users/dmitrii.malakhov/git/evm/api/node_modules/.pnpm/drizzle-orm@0.44.7_better-sqlite3@11.10.0/node_modules/src/sqlite-core/dialect.ts:849:15)
    ... 4 lines matching cause stack trace ...
    at async asyncRunEntryPointWithESMLoader (node:internal/modules/run_main:116:5) {
  cause: RangeError: The supplied SQL string contains more than one statement
      at Database.prepare (/Users/dmitrii.malakhov/git/evm/api/node_modules/.pnpm/better-sqlite3@11.10.0/node_modules/better-sqlite3/lib/methods/wrappers.js:5:21)
      at BetterSQLiteSession.prepareQuery (/Users/dmitrii.malakhov/git/evm/api/node_modules/.pnpm/drizzle-orm@0.44.7_better-sqlite3@11.10.0/node_modules/src/better-sqlite3/session.ts:60:28)
      at BetterSQLiteSession.prepareOneTimeQuery (/Users/dmitrii.malakhov/git/evm/api/node_modules/.pnpm/drizzle-orm@0.44.7_better-sqlite3@11.10.0/node_modules/src/sqlite-core/session.ts:250:15)
      at BetterSQLiteSession.run (/Users/dmitrii.malakhov/git/evm/api/node_modules/.pnpm/drizzle-orm@0.44.7_better-sqlite3@11.10.0/node_modules/src/sqlite-core/session.ts:269:16)
      at SQLiteSyncDialect.migrate (/Users/dmitrii.malakhov/git/evm/api/node_modules/.pnpm/drizzle-orm@0.44.7_better-sqlite3@11.10.0/node_modules/src/sqlite-core/dialect.ts:849:15)
      at migrate (/Users/dmitrii.malakhov/git/evm/api/node_modules/.pnpm/drizzle-orm@0.44.7_better-sqlite3@11.10.0/node_modules/src/better-sqlite3/migrator.ts:10:13)
      at <anonymous> (/Users/dmitrii.malakhov/git/evm/api/src/db/client.ts:42:5)
      at ModuleJob.run (node:internal/modules/esm/module_job:271:25)
      at async onImport.tracePromise.__proto__ (node:internal/modules/esm/loader:578:26)
      at async asyncRunEntryPointWithESMLoader (node:internal/modules/run_main:116:5)
}

Node.js v22.14.0
7:02:07 PM [tsx] change in ./src/routes/admin.ts Rerunning...
c/Users/dmitrii.malakhov/git/evm/api/node_modules/.pnpm/drizzle-orm@0.44.7_better-sqlite3@11.10.0/node_modules/src/sqlite-core/session.ts:271
			throw new DrizzleError({ cause: err, message: `Failed to run the query '${staticQuery.sql}'` });
			      ^


DrizzleError: Failed to run the query 'CREATE TABLE IF NOT EXISTS `iterations` (
  `id` text PRIMARY KEY NOT NULL,
  `name` text NOT NULL,
  `starts_at` integer NOT NULL,
  `ends_at` integer NOT NULL,
  `total_weeks` integer NOT NULL DEFAULT 6,
  `current_week` integer NOT NULL DEFAULT 1
);

ALTER TABLE `levels` ADD COLUMN `iteration_id` text REFERENCES `iterations`(`id`) ON DELETE SET NULL;

DROP INDEX IF EXISTS `levels_week_idx`;
CREATE UNIQUE INDEX IF NOT EXISTS `levels_iteration_week_idx` ON `levels` (`iteration_id`, `week`);

ALTER TABLE `team_progress` ADD COLUMN `total_points` integer NOT NULL DEFAULT 0;
ALTER TABLE `team_progress` ADD COLUMN `completed_weeks` text NOT NULL DEFAULT '[]';
ALTER TABLE `team_progress` ADD COLUMN `weekly_stats` text NOT NULL DEFAULT '[]';

CREATE TABLE IF NOT EXISTS `user_week_progress` (
  `id` text PRIMARY KEY NOT NULL,
  `user_id` text NOT NULL,
  `iteration_id` text NOT NULL,
  `week` integer NOT NULL,
  `completed_tasks` text NOT NULL DEFAULT '[]',
  `points_earned` integer NOT NULL DEFAULT 0,
  `is_completed` integer NOT NULL DEFAULT 0,
  `finished_at` integer,
  `key_id` text,
  `title` text,
  FOREIGN KEY (`user_id`) REFERENCES `users`(`id`) ON DELETE CASCADE,
  FOREIGN KEY (`iteration_id`) REFERENCES `iterations`(`id`) ON DELETE CASCADE
);

CREATE UNIQUE INDEX IF NOT EXISTS `user_week_iteration_idx` ON `user_week_progress` (`user_id`, `iteration_id`, `week`);
'
    at BetterSQLiteSession.run (/Users/dmitrii.malakhov/git/evm/api/node_modules/.pnpm/drizzle-orm@0.44.7_better-sqlite3@11.10.0/node_modules/src/sqlite-core/session.ts:271:10)
    at SQLiteSyncDialect.migrate (/Users/dmitrii.malakhov/git/evm/api/node_modules/.pnpm/drizzle-orm@0.44.7_better-sqlite3@11.10.0/node_modules/src/sqlite-core/dialect.ts:849:15)
    ... 4 lines matching cause stack trace ...
    at async asyncRunEntryPointWithESMLoader (node:internal/modules/run_main:116:5) {
  cause: RangeError: The supplied SQL string contains more than one statement
      at Database.prepare (/Users/dmitrii.malakhov/git/evm/api/node_modules/.pnpm/better-sqlite3@11.10.0/node_modules/better-sqlite3/lib/methods/wrappers.js:5:21)
      at BetterSQLiteSession.prepareQuery (/Users/dmitrii.malakhov/git/evm/api/node_modules/.pnpm/drizzle-orm@0.44.7_better-sqlite3@11.10.0/node_modules/src/better-sqlite3/session.ts:60:28)
      at BetterSQLiteSession.prepareOneTimeQuery (/Users/dmitrii.malakhov/git/evm/api/node_modules/.pnpm/drizzle-orm@0.44.7_better-sqlite3@11.10.0/node_modules/src/sqlite-core/session.ts:250:15)
      at BetterSQLiteSession.run (/Users/dmitrii.malakhov/git/evm/api/node_modules/.pnpm/drizzle-orm@0.44.7_better-sqlite3@11.10.0/node_modules/src/sqlite-core/session.ts:269:16)
      at SQLiteSyncDialect.migrate (/Users/dmitrii.malakhov/git/evm/api/node_modules/.pnpm/drizzle-orm@0.44.7_better-sqlite3@11.10.0/node_modules/src/sqlite-core/dialect.ts:849:15)
      at migrate (/Users/dmitrii.malakhov/git/evm/api/node_modules/.pnpm/drizzle-orm@0.44.7_better-sqlite3@11.10.0/node_modules/src/better-sqlite3/migrator.ts:10:13)
      at <anonymous> (/Users/dmitrii.malakhov/git/evm/api/src/db/client.ts:42:5)
      at ModuleJob.run (node:internal/modules/esm/module_job:271:25)
      at async onImport.tracePromise.__proto__ (node:internal/modules/esm/loader:578:26)
      at async asyncRunEntryPointWithESMLoader (node:internal/modules/run_main:116:5)
}

Node.js v22.14.0
7:02:17 PM [tsx] change in ./src/routes/admin.ts Rerunning...
c/Users/dmitrii.malakhov/git/evm/api/node_modules/.pnpm/drizzle-orm@0.44.7_better-sqlite3@11.10.0/node_modules/src/sqlite-core/session.ts:271
			throw new DrizzleError({ cause: err, message: `Failed to run the query '${staticQuery.sql}'` });
			      ^


DrizzleError: Failed to run the query 'CREATE TABLE IF NOT EXISTS `iterations` (
  `id` text PRIMARY KEY NOT NULL,
  `name` text NOT NULL,
  `starts_at` integer NOT NULL,
  `ends_at` integer NOT NULL,
  `total_weeks` integer NOT NULL DEFAULT 6,
  `current_week` integer NOT NULL DEFAULT 1
);

ALTER TABLE `levels` ADD COLUMN `iteration_id` text REFERENCES `iterations`(`id`) ON DELETE SET NULL;

DROP INDEX IF EXISTS `levels_week_idx`;
CREATE UNIQUE INDEX IF NOT EXISTS `levels_iteration_week_idx` ON `levels` (`iteration_id`, `week`);

ALTER TABLE `team_progress` ADD COLUMN `total_points` integer NOT NULL DEFAULT 0;
ALTER TABLE `team_progress` ADD COLUMN `completed_weeks` text NOT NULL DEFAULT '[]';
ALTER TABLE `team_progress` ADD COLUMN `weekly_stats` text NOT NULL DEFAULT '[]';

CREATE TABLE IF NOT EXISTS `user_week_progress` (
  `id` text PRIMARY KEY NOT NULL,
  `user_id` text NOT NULL,
  `iteration_id` text NOT NULL,
  `week` integer NOT NULL,
  `completed_tasks` text NOT NULL DEFAULT '[]',
  `points_earned` integer NOT NULL DEFAULT 0,
  `is_completed` integer NOT NULL DEFAULT 0,
  `finished_at` integer,
  `key_id` text,
  `title` text,
  FOREIGN KEY (`user_id`) REFERENCES `users`(`id`) ON DELETE CASCADE,
  FOREIGN KEY (`iteration_id`) REFERENCES `iterations`(`id`) ON DELETE CASCADE
);

CREATE UNIQUE INDEX IF NOT EXISTS `user_week_iteration_idx` ON `user_week_progress` (`user_id`, `iteration_id`, `week`);
'
    at BetterSQLiteSession.run (/Users/dmitrii.malakhov/git/evm/api/node_modules/.pnpm/drizzle-orm@0.44.7_better-sqlite3@11.10.0/node_modules/src/sqlite-core/session.ts:271:10)
    at SQLiteSyncDialect.migrate (/Users/dmitrii.malakhov/git/evm/api/node_modules/.pnpm/drizzle-orm@0.44.7_better-sqlite3@11.10.0/node_modules/src/sqlite-core/dialect.ts:849:15)
    ... 4 lines matching cause stack trace ...
    at async asyncRunEntryPointWithESMLoader (node:internal/modules/run_main:116:5) {
  cause: RangeError: The supplied SQL string contains more than one statement
      at Database.prepare (/Users/dmitrii.malakhov/git/evm/api/node_modules/.pnpm/better-sqlite3@11.10.0/node_modules/better-sqlite3/lib/methods/wrappers.js:5:21)
      at BetterSQLiteSession.prepareQuery (/Users/dmitrii.malakhov/git/evm/api/node_modules/.pnpm/drizzle-orm@0.44.7_better-sqlite3@11.10.0/node_modules/src/better-sqlite3/session.ts:60:28)
      at BetterSQLiteSession.prepareOneTimeQuery (/Users/dmitrii.malakhov/git/evm/api/node_modules/.pnpm/drizzle-orm@0.44.7_better-sqlite3@11.10.0/node_modules/src/sqlite-core/session.ts:250:15)
      at BetterSQLiteSession.run (/Users/dmitrii.malakhov/git/evm/api/node_modules/.pnpm/drizzle-orm@0.44.7_better-sqlite3@11.10.0/node_modules/src/sqlite-core/session.ts:269:16)
      at SQLiteSyncDialect.migrate (/Users/dmitrii.malakhov/git/evm/api/node_modules/.pnpm/drizzle-orm@0.44.7_better-sqlite3@11.10.0/node_modules/src/sqlite-core/dialect.ts:849:15)
      at migrate (/Users/dmitrii.malakhov/git/evm/api/node_modules/.pnpm/drizzle-orm@0.44.7_better-sqlite3@11.10.0/node_modules/src/better-sqlite3/migrator.ts:10:13)
      at <anonymous> (/Users/dmitrii.malakhov/git/evm/api/src/db/client.ts:42:5)
      at ModuleJob.run (node:internal/modules/esm/module_job:271:25)
      at async onImport.tracePromise.__proto__ (node:internal/modules/esm/loader:578:26)
      at async asyncRunEntryPointWithESMLoader (node:internal/modules/run_main:116:5)
}

Node.js v22.14.0
7:02:35 PM [tsx] change in ./src/routes/admin.ts Rerunning...
c/Users/dmitrii.malakhov/git/evm/api/node_modules/.pnpm/drizzle-orm@0.44.7_better-sqlite3@11.10.0/node_modules/src/sqlite-core/session.ts:271
			throw new DrizzleError({ cause: err, message: `Failed to run the query '${staticQuery.sql}'` });
			      ^


DrizzleError: Failed to run the query 'CREATE TABLE IF NOT EXISTS `iterations` (
  `id` text PRIMARY KEY NOT NULL,
  `name` text NOT NULL,
  `starts_at` integer NOT NULL,
  `ends_at` integer NOT NULL,
  `total_weeks` integer NOT NULL DEFAULT 6,
  `current_week` integer NOT NULL DEFAULT 1
);

ALTER TABLE `levels` ADD COLUMN `iteration_id` text REFERENCES `iterations`(`id`) ON DELETE SET NULL;

DROP INDEX IF EXISTS `levels_week_idx`;
CREATE UNIQUE INDEX IF NOT EXISTS `levels_iteration_week_idx` ON `levels` (`iteration_id`, `week`);

ALTER TABLE `team_progress` ADD COLUMN `total_points` integer NOT NULL DEFAULT 0;
ALTER TABLE `team_progress` ADD COLUMN `completed_weeks` text NOT NULL DEFAULT '[]';
ALTER TABLE `team_progress` ADD COLUMN `weekly_stats` text NOT NULL DEFAULT '[]';

CREATE TABLE IF NOT EXISTS `user_week_progress` (
  `id` text PRIMARY KEY NOT NULL,
  `user_id` text NOT NULL,
  `iteration_id` text NOT NULL,
  `week` integer NOT NULL,
  `completed_tasks` text NOT NULL DEFAULT '[]',
  `points_earned` integer NOT NULL DEFAULT 0,
  `is_completed` integer NOT NULL DEFAULT 0,
  `finished_at` integer,
  `key_id` text,
  `title` text,
  FOREIGN KEY (`user_id`) REFERENCES `users`(`id`) ON DELETE CASCADE,
  FOREIGN KEY (`iteration_id`) REFERENCES `iterations`(`id`) ON DELETE CASCADE
);

CREATE UNIQUE INDEX IF NOT EXISTS `user_week_iteration_idx` ON `user_week_progress` (`user_id`, `iteration_id`, `week`);
'
    at BetterSQLiteSession.run (/Users/dmitrii.malakhov/7:02:55 PM [tsx] change in ./src/routes/admin.ts Restarting...
cAPI server listening on http://0.0.0.0:4000
7:03:10 PM [tsx] change in ./src/routes/admin.ts Restarting...
cAPI server listening on http://0.0.0.0:4000
[0mGET /me [36m304[0m 6.462 ms - -[0m
[0mGET /features [36m304[0m 2.103 ms - -[0m
[0mGET /teams/t1 [36m304[0m 0.706 ms - -[0m
[0mGET /teams/t1/progress [36m304[0m 2.853 ms - -[0m
[0mGET /levels/current [33m404[0m 5.362 ms - 63[0m
[0mGET /teams/t1/chat [36m304[0m 0.716 ms - -[0m
[0mGET /teams/t1/ideas [36m304[0m 2.277 ms - -[0m
[0mGET /teams/t1/progress [36m304[0m 1.031 ms - -[0m
[0mGET /teams/t1/chat [36m304[0m 1.240 ms - -[0m
[0mGET /teams/t1/ideas [36m304[0m 6.459 ms - -[0m
[0mGET /levels/current [33m404[0m 1.444 ms - 63[0m
[0mGET /teams/t1 [36m304[0m 1.200 ms - -[0m
7:10:56 PM [tsx] change in ./src/routes/admin.ts Restarting...
cAPI server listening on http://0.0.0.0:4000
[0mGET /levels/week/3 [33m404[0m 3.250 ms - 46[0m
[0mGET /levels/week/3 [33m404[0m 0.707 ms - 46[0m
[0mGET /teams/t1 [36m304[0m 0.736 ms - -[0m
[0mGET /teams/t1/ideas [36m304[0m 2.199 ms - -[0m
[0mGET /teams/t1/chat [36m304[0m 0.321 ms - -[0m
[0mGET /teams/t1/ideas [36m304[0m 0.676 ms - -[0m
[0mGET /teams/t1/progress [36m304[0m 0.854 ms - -[0m
[0mGET /teams/t1/progress [36m304[0m 0.309 ms - -[0m
[0mGET /teams/t1 [36m304[0m 0.587 ms - -[0m
[0mGET /teams/t1/chat [36m304[0m 0.258 ms - -[0m
[0mGET /feed [36m304[0m 0.751 ms - -[0m
[0mGET /feed [36m304[0m 0.505 ms - -[0m
[0mGET /feed [36m304[0m 0.278 ms - -[0m
[0mGET /feed [36m304[0m 0.258 ms - -[0m
[0mGET /feed [36m304[0m 0.250 ms - -[0m
[0mGET /feed [36m304[0m 0.194 ms - -[0m
[0mGET /tickets/me [36m304[0m 0.575 ms - -[0m
[0mGET /tickets/me [36m304[0m 0.476 ms - -[0m
[0mGET /me [36m304[0m 0.558 ms - -[0m
[0mGET /features [36m304[0m 0.523 ms - -[0m
[0mGET /tickets/me [36m304[0m 0.421 ms - -[0m
[0mGET /tickets/me [36m304[0m 0.714 ms - -[0m
[0mPOST /auth/login [32m200[0m 2.803 ms - 128[0m
[0mGET /me [36m304[0m 0.441 ms - -[0m
[0mGET /features [36m304[0m 0.184 ms - -[0m
[0mGET /teams/t1 [36m304[0m 0.420 ms - -[0m
[0mGET /teams/t1/chat [36m304[0m 1.146 ms - -[0m
[0mGET /teams/t1 [36m304[0m 0.391 ms - -[0m
[0mGET /teams/t1/ideas [36m304[0m 2.334 ms - -[0m
[0mGET /teams/t1/chat [36m304[0m 0.503 ms - -[0m
[0mGET /levels/current [33m404[0m 0.705 ms - 63[0m
[0mGET /teams/t1/progress [36m304[0m 0.398 ms - -[0m
[0mGET /teams/t1/ideas [36m304[0m 1.063 ms - -[0m
[0mGET /levels/current [33m404[0m 0.685 ms - 63[0m
[0mGET /teams/t1/progress [36m304[0m 0.474 ms - -[0m
[0mGET /levels/week/3 [33m404[0m 0.728 ms - 46[0m
[0mGET /levels/week/3 [33m404[0m 0.499 ms - 46[0m
[0mGET /teams/t1 [36m304[0m 0.507 ms - -[0m
[0mGET /teams/t1/chat [36m304[0m 0.528 ms - -[0m
[0mGET /teams/t1/ideas [36m304[0m 1.404 ms - -[0m
[0mGET /teams/t1/progress [36m304[0m 0.255 ms - -[0m
[0mGET /teams/t1/chat [36m304[0m 0.276 ms - -[0m
[0mGET /teams/t1/ideas [36m304[0m 0.621 ms - -[0m
[0mGET /teams/t1/progress [36m304[0m 0.371 ms - -[0m
[0mGET /teams/t1 [36m304[0m 0.123 ms - -[0m
[0mGET /feed [36m304[0m 0.436 ms - -[0m
[0mGET /feed [36m304[0m 0.470 ms - -[0m
[0mGET /feed [36m304[0m 0.351 ms - -[0m
[0mGET /feed [36m304[0m 0.283 ms - -[0m
[0mGET /feed [36m304[0m 0.333 ms - -[0m
[0mGET /feed [36m304[0m 0.185 ms - -[0m
[0mGET /tickets/me [36m304[0m 0.896 ms - -[0m
[0mGET /tickets/me [36m304[0m 1.388 ms - -[0m
[0mGET /teams/t1 [36m304[0m 1.630 ms - -[0m
[0mGET /teams/t1/chat [36m304[0m 0.399 ms - -[0m
[0mGET /teams/t1/progress [36m304[0m 0.470 ms - -[0m
[0mGET /teams/t1/ideas [36m304[0m 0.973 ms - -[0m
[0mGET /teams/t1/progress [36m304[0m 0.396 ms - -[0m
[0mGET /teams/t1/ideas [36m304[0m 0.679 ms - -[0m
[0mGET /teams/t1 [36m304[0m 0.295 ms - -[0m
[0mGET /teams/t1/chat [36m304[0m 0.534 ms - -[0m
[0mPOST /auth/login [32m200[0m 3.903 ms - 128[0m
[0mGET /me [36m304[0m 0.730 ms - -[0m
[0mGET /features [36m304[0m 0.370 ms - -[0m
[0mGET /teams/t1 [36m304[0m 0.322 ms - -[0m
[0mGET /teams/t1/progress [36m304[0m 0.833 ms - -[0m
[0mGET /teams/t1/chat [36m304[0m 0.358 ms - -[0m
[0mGET /teams/t1/ideas [36m304[0m 0.865 ms - -[0m
[0mGET /teams/t1/progress [36m304[0m 0.293 ms - -[0m
[0mGET /teams/t1/chat [36m304[0m 0.168 ms - -[0m
[0mGET /teams/t1/ideas [36m304[0m 0.591 ms - -[0m
[0mGET /levels/current [33m404[0m 1.264 ms - 63[0m
[0mGET /teams/t1 [36m304[0m 0.182 ms - -[0m
[0mGET /levels/current [33m404[0m 0.522 ms - 63[0m
[0mGET /admin/levels [32m200[0m 0.809 ms - 386[0m
[0mGET /admin/metrics [32m200[0m 1.138 ms - 574[0m
[0mGET /admin/levels [36m304[0m 0.183 ms - -[0m
[0mGET /admin/metrics [36m304[0m 0.463 ms - -[0m
[0mGET /tickets/me [36m304[0m 0.517 ms - -[0m
[0mGET /tickets/me [36m304[0m 0.609 ms - -[0m
[0mGET /admin/metrics [36m304[0m 0.284 ms - -[0m
[0mGET /admin/levels [36m304[0m 0.391 ms - -[0m
[0mGET /admin/levels [36m304[0m 0.160 ms - -[0m
[0mGET /admin/metrics [36m304[0m 0.147 ms - -[0m
[0mGET /admin/levels [36m304[0m 0.630 ms - -[0m
[0mGET /admin/metrics [36m304[0m 0.323 ms - -[0m
[0mGET /me [36m304[0m 1.122 ms - -[0m
[0mGET /features [36m304[0m 0.432 ms - -[0m
[0mGET /admin/levels [36m304[0m 0.317 ms - -[0m
[0mGET /admin/metrics [36m304[0m 0.417 ms - -[0m
[0mGET /admin/levels [36m304[0m 0.252 ms - -[0m
[0mGET /admin/metrics [36m304[0m 0.154 ms - -[0m
[0mGET /me [36m304[0m 0.871 ms - -[0m
[0mGET /features [36m304[0m 0.244 ms - -[0m
[0mGET /admin/levels [36m304[0m 0.353 ms - -[0m
[0mGET /admin/metrics [36m304[0m 0.225 ms - -[0m
[0mGET /admin/levels [36m304[0m 1.046 ms - -[0m
[0mGET /admin/metrics [36m304[0m 0.851 ms - -[0m
[0mGET /levels/week/3 [33m404[0m 1.487 ms - 46[0m
[0mGET /levels/week/3 [33m404[0m 0.691 ms - 46[0m
[0mGET /teams/t1 [36m304[0m 0.298 ms - -[0m
[0mGET /teams/t1/progress [36m304[0m 0.238 ms - -[0m
[0mGET /teams/t1/chat [36m304[0m 0.260 ms - -[0m
[0mGET /teams/t1/ideas [36m304[0m 0.828 ms - -[0m
[0mGET /levels/current [33m404[0m 0.355 ms - 63[0m
[0mGET /teams/t1/chat [36m304[0m 0.142 ms - -[0m
[0mGET /teams/t1/ideas [36m304[0m 0.669 ms - -[0m
[0mGET /teams/t1/progress [36m304[0m 0.306 ms - -[0m
[0mGET /teams/t1 [36m304[0m 0.112 ms - -[0m
[0mGET /levels/current [33m404[0m 0.390 ms - 63[0m
[0mGET /feed [36m304[0m 1.048 ms - -[0m
[0mGET /feed [36m304[0m 0.417 ms - -[0m
[0mGET /feed [36m304[0m 0.238 ms - -[0m
[0mGET /feed [36m304[0m 0.231 ms - -[0m
[0mGET /feed [36m304[0m 0.234 ms - -[0m
[0mGET /feed [36m304[0m 0.246 ms - -[0m
[0mGET /tickets/me [36m304[0m 0.941 ms - -[0m
[0mGET /tickets/me [36m304[0m 0.691 ms - -[0m
10:52:50 AM [tsx] change in ./src/services/admin.ts Restarting...
cAPI server listening on http://0.0.0.0:4000
10:53:01 AM [tsx] change in ./src/services/admin.ts Restarting...
cAPI server listening on http://0.0.0.0:4000
10:53:06 AM [tsx] change in ./src/routes/admin.ts Restarting...
cAPI server listening on http://0.0.0.0:4000
10:53:22 AM [tsx] change in ./src/routes/admin.ts Restarting...
cAPI server listening on http://0.0.0.0:4000
[0mGET /me [36m304[0m 6.511 ms - -[0m
[0mGET /features [36m304[0m 1.529 ms - -[0m
[0mGET /tickets/me [36m304[0m 2.282 ms - -[0m
[0mGET /tickets/me [36m304[0m 4.145 ms - -[0m
10:57:41 AM [tsx] change in ./src/routes/admin.ts Restarting...
cAPI server listening on http://0.0.0.0:4000
[0mGET /admin/levels [36m304[0m 2.880 ms - -[0m
[0mGET /admin/metrics [36m304[0m 0.886 ms - -[0m
[0mGET /admin/iterations [32m200[0m 0.481 ms - 2[0m
[0mGET /admin/levels [36m304[0m 0.178 ms - -[0m
[0mGET /admin/metrics [36m304[0m 0.301 ms - -[0m
[0mGET /admin/levels/lvl3/tasks [32m200[0m 1.609 ms - 490[0m
[0mGET /admin/iterations [36m304[0m 0.211 ms - -[0m
[0mGET /admin/moderation/submissions [32m200[0m 0.998 ms - 361[0m
[0mGET /admin/levels/lvl3/tasks [36m304[0m 0.877 ms - -[0m
[0mGET /admin/moderation/submissions [36m304[0m 0.615 ms - -[0m
[0mPUT /admin/levels/lvl3 [32m200[0m 4.057 ms - 392[0m
[0mGET /admin/levels [32m200[0m 0.575 ms - 394[0m
 at async asyncRunEntryPointWithESMLoader (node:internal/modules/run_main:116:5) {
  cause: RangeError: The supplied SQL string contains more than one statement
      at Database.prepare (/Users/dmitrii.malakhov/git/evm/api/node_modules/.pnpm/better-sqlite3@11.10.0/node_modules/better-sqlite3/lib/methods/wrappers.js:5:21)
      at BetterSQLiteSession.prepareQuery (/Users/dmitrii.malakhov/git/evm/api/node_modules/.pnpm/drizzle-orm@0.44.7_better-sqlite3@11.10.0/node_modules/src/better-sqlite3/session.ts:60:28)
      at BetterSQLiteSession.prepareOneTimeQuery (/Users/dmitrii.malakhov/git/evm/api/node_modules/.pnpm/drizzle-orm@0.44.7_better-sqlite3@11.10.0/node_modules/src/sqlite-core/session.ts:250:15)
      at BetterSQLiteSession.run (/Users/dmitrii.malakhov/git/evm/api/node_modules/.pnpm/drizzle-orm@0.44.7_better-sqlite3@11.10.0/node_modules/src/sqlite-core/session.ts:269:16)
      at SQLiteSyncDialect.migrate (/Users/dmitrii.malakhov/git/evm/api/node_modules/.pnpm/drizzle-orm@0.44.7_better-sq7:10:56 PM [tsx] change in ./src/routes/admin.ts Rerunning...
c/Users/dmitrii.malakhov/git/evm/api/node_modules/.pnpm/drizzle-orm@0.44.7_better-sqlite3@11.10.0/node_modules/src/sqlite-core/session.ts:271
			throw new DrizzleError({ cause: err, message: `Failed to run the query '${staticQuery.sql}'` });
			      ^


DrizzleError: Failed to run the query 'CREATE TABLE IF NOT EXISTS `iterations` (
  `id` text PRIMARY KEY NOT NULL,
  `name` text NOT NULL,
  `starts_at` integer NOT NULL,
  `ends_at` integer NOT NULL,
  `total_weeks` integer NOT NULL DEFAULT 6,
  `current_week` integer NOT NULL DEFAULT 1
);

ALTER TABLE `levels` ADD COLUMN `iteration_id` text REFERENCES `iterations`(`id`) ON DELETE SET NULL;

DROP INDEX IF EXISTS `levels_week_idx`;
CREATE UNIQUE INDEX IF NOT EXISTS `levels_iteration_week_idx` ON `levels` (`iteration_id`, `week`);

ALTER TABLE `team_progress` ADD COLUMN `total_points` integer NOT NULL DEFAULT 0;
ALTER TABLE `team_progress` ADD COLUMN `completed_weeks` text NOT NULL DEFAULT '[]';
ALTER TABLE `team_progress` ADD COLUMN `weekly_stats` text NOT NULL DEFAULT '[]';

CREATE TABLE IF NOT EXISTS `user_week_progress` (
  `id` text PRIMARY KEY NOT NULL,
  `user_id` text NOT NULL,
  `iteration_id` text NOT NULL,
  `week` integer NOT NULL,
  `completed_tasks` text NOT NULL DEFAULT '[]',
  `points_earned` integer NOT NULL DEFAULT 0,
  `is_completed` integer NOT NULL DEFAULT 0,
  `finished_at` integer,
  `key_id` text,
  `title` text,
  FOREIGN KEY (`user_id`) REFERENCES `users`(`id`) ON DELETE CASCADE,
  FOREIGN KEY (`iteration_id`) REFERENCES `iterations`(`id`) ON DELETE CASCADE
);

CREATE UNIQUE INDEX IF NOT EXISTS `user_week_iteration_idx` ON `user_week_progress` (`user_id`, `iteration_id`, `week`);
'
    at BetterSQLiteSession.run (/Users/dmitrii.malakhov/git/evm/api/node_modules/.pnpm/drizzle-orm@0.44.7_better-sqlite3@11.10.0/node_modules/src/sqlite-core/session.ts:271:10)
    at SQLiteSyncDialect.migrate (/Users/dmitrii.malakhov/git/evm/api/node_modules/.pnpm/drizzle-orm@0.44.7_better-sqlite3@11.10.0/node_modules/src/sqlite-core/dialect.ts:849:15)
    ... 4 lines matching cause stack trace ...
    at async asyncRunEntryPointWithESMLoader (node:internal/modules/run_main:116:5) {
  cause: RangeError: The supplied SQL string contains more than one statement
      at Database.prepare (/Users/dmitrii.malakhov/git/evm/api/node_modules/.pnpm/better-sqlite3@11.10.0/node_modules/better-sqlite3/lib/methods/wrappers.js:5:21)
      at BetterSQLiteSession.prepareQuery (/Users/dmitrii.malakhov/git/evm/api/node_modules/.pnpm/drizzle-orm@0.44.7_better-sqlite3@11.10.0/node_modules/src/better-sqlite3/session.ts:60:28)
      at BetterSQLiteSession.prepareOneTimeQuery (/Users/dmitrii.malakhov/git/evm/api/node_modules/.pnpm/drizzle-orm@0.44.7_better-sqlite3@11.10.0/node_modules/src/sqlite-core/session.ts:250:15)
      at BetterSQLiteSession.run (/Users/dmitrii.malakhov/git/evm/api/node_modules/.pnpm/drizzle-orm@0.44.7_better-sqlite3@11.10.0/node_modules/src/sqlite-core/session.ts:269:16)
      at SQLiteSyncDialect.migrate (/Users/dmitrii.malakhov/git/evm/api/node_modules/.pnpm/drizzle-orm@0.44.7_better-sqlite3@11.10.0/node_modules/src/sqlite-core/dialect.ts:849:15)
      at migrate (/Users/dmitrii.malakhov/git/evm/api/node_modules/.pnpm/drizzle-orm@0.44.7_better-sqlite3@11.10.0/node_modules/src/better-sqlite3/migrator.ts:10:13)
      at <anonymous> (/Users/dmitrii.malakhov/git/evm/api/src/db/client.ts:42:5)
      at ModuleJob.run (node:internal/modules/esm/module_job:271:25)
      at async onImport.tracePromise.__proto__ (node:internal/modules/esm/loader:578:26)
      at async asyncRunEntryPointWithESMLoader (node:internal/modules/run_main:116:5)
}

Node.js v22.14.0
10:52:50 AM [tsx] change in ./src/services/admin.ts Rerunning...
c/Users/dmitrii.malakhov/git/evm/api/node_modules/.pnpm/drizzle-orm@0.44.7_better-sqlite3@11.10.0/node_modules/src/sqlite-core/session.ts:271
			throw new DrizzleError({ cause: err, message: `Failed to run the query '${staticQuery.sql}'` });
			      ^


DrizzleError: Failed to run the query 'CREATE TABLE IF NOT EXISTS `iterations` (
  `id` text PRIMARY KEY NOT NULL,
  `name` text NOT NULL,
  `starts_at` integer NOT NULL,
  `ends_at` integer NOT NULL,
  `total_weeks` integer NOT NULL DEFAULT 6,
  `current_week` integer NOT NULL DEFAULT 1
);

ALTER TABLE `levels` ADD C/Users/dmitrii.malakhov/git/evm/api/node_modules/.pnpm/drizzle-orm@0.44.7_better-sqlite3@11.10.0/node_modules/src/sqlite-core/session.ts:271
			throw new DrizzleError({ cause: err, message: `Failed to run the query '${staticQuery.sql}'` });
			      ^


DrizzleError: Failed to run the query 'CREATE TABLE IF NOT EXISTS `iterations` (
  `id` text PRIMARY KEY NOT NULL,
  `name` text NOT NULL,
  `starts_at` integer NOT NULL,
  `ends_at` integer NOT NULL,
  `total_weeks` integer NOT NULL DEFAULT 6,
  `current_week` integer NOT NULL DEFAULT 1
);

ALTER TABLE `levels` ADD COLUMN `iteration_id` text REFERENCES `iterations`(`id`) ON DELETE SET NULL;

DROP INDEX IF EXISTS `levels_week_idx`;
CREATE UNIQUE INDEX IF NOT EXISTS `levels_iteration_week_idx` ON `levels` (`iteration_id`, `week`);

ALTER TABLE `team_progress` ADD COLUMN `total_points` integer NOT NULL DEFAULT 0;
ALTER TABLE `team_progress` ADD COLUMN `completed_weeks` text NOT NULL DEFAULT '[]';
ALTER TABLE `team_progress` ADD COLUMN `weekly_stats` text NOT NULL DEFAULT '[]';

CREATE TABLE IF NOT EXISTS `user_week_progress` (
  `id` text PRIMARY KEY NOT NULL,
  `user_id` text NOT NULL,
  `iteration_id` text NOT NULL,
  `week` integer NOT NULL,
  `completed_tasks` text NOT NULL DEFAULT '[]',
  `points_earned` integer NOT NULL DEFAULT 0,
  `is_completed` integer NOT NULL DEFAULT 0,
  `finished_at` integer,
  `key_id` text,
  `title` text,
  FOREIGN KEY (`user_id`) REFERENCES `users`(`id`) ON DELETE CASCADE,
  FOREIGN KEY (`iteration_id`) REFERENCES `iterations`(`id`) ON DELETE CASCADE
);

CREATE UNIQUE INDEX IF NOT EXISTS `user_week_iteration_idx` ON `user_week_progress` (`user_id`, `iteration_id`, `week`);
'
    at BetterSQLiteSession.run (/Users/dmitrii.malakhov/git/evm/api/node_modules/.pnpm/drizzle-orm@0.44.7_better-sqlite3@11.10.0/node_modules/src/sqlite-core/session.ts:271:10)
    at SQLiteSyncDialect.migrate (/Users/dmitrii.malakhov/git/evm/api/node_modules/.pnpm/drizzle-orm@0.44.7_better-sqlite3@11.10.0/node_modules/src/sqlite-core/dialect.ts:849:15)
    ... 4 lines matching cause stack trace ...
    at async asyncRunEntryPointWithESMLoader (node:internal/modules/run_main:116:5) {
  cause: RangeError: The supplied SQL string contains more than one statement
      at Database.prepare (/Users/dmitrii.malakhov/git/evm/api/node_modules/.pnpm/better-sqlite3@11.10.0/node_modules/better-sqlite3/lib/methods/wrappers.js:5:21)
      at BetterSQLiteSession.prepareQuery (/Users/dmitrii.malakhov/git/evm/api/node_modules/.pnpm/drizzle-orm@0.44.7_better-sqlite3@11.10.0/node_modules/src/better-sqlite3/session.ts:60:28)
      at BetterSQLiteSession.prepareOneTimeQuery (/Users/dmitrii.malakhov/git/evm/api/node_modules/.pnpm/drizzle-orm@0.44.7_better-sqlite3@11.10.0/node_modules/src/sqlite-core/session.ts:250:15)
      at BetterSQLiteSession.run (/Users/dmitrii.malakhov/git/evm/api/node_modules/.pnpm/drizzle-orm@0.44.7_better-sqlite3@11.10.0/node_modules/src/sqlite-core/session.ts:269:16)
      at SQLiteSyncDialect.migrate (/Users/dmitrii.malakhov/git/evm/api/node_modules/.pnpm/drizzle-orm@0.44.7_better-sq10:53:01 AM [tsx] change in ./src/services/admin.ts Rerunning...
c/Users/dmitrii.malakhov/git/evm/api/node_modules/.pnpm/drizzle-orm@0.44.7_better-sqlite3@11.10.0/node_modules/src/sqlite-core/session.ts:271
			throw new DrizzleError({ cause: err, message: `Failed to run the query '${staticQuery.sql}'` });
			      ^


DrizzleError: Failed to run the query 'CREATE TABLE IF NOT EXISTS `iterations` (
  `id` text PRIMARY KEY NOT NULL,
  `name` text NOT NULL,
  `starts_at` integer NOT NULL,
  `ends_at` integer NOT NULL,
  `total_weeks` integer NOT NULL DEFAULT 6,
  `current_week` integer NOT NULL DEFAULT 1
);

ALTER TABLE `levels` ADD C/Users/dmitrii.malakhov/git/evm/api/node_modules/.pnpm/drizzle-orm@0.44.7_better-sqlite3@11.10.0/node_modules/src/sqlite-core/session.ts:271
			throw new DrizzleError({ cause: err, message: `Failed to run the query '${staticQuery.sql}'` });
			      ^


DrizzleError: Failed to run the query 'CREATE TABLE IF NOT EXISTS `iterations` (
  `id` text PRIMARY KEY NOT NULL,
  `name` text NOT NULL,
  `starts_at` integer NOT NULL,
  `ends_at` integer NOT NULL,
  `total_weeks` integer NOT NULL DEFAULT 6,
  `current_week` integer NOT NULL DEFAULT 1
);

ALTER TABLE `levels` ADD COLUMN `iteration_id` text REFERENCES `iterations`(`id`) ON DELETE SET NULL;

DROP INDEX IF EXISTS `levels_week_idx`;
CREATE UNIQUE INDEX IF NOT EXISTS `levels_iteration_week_idx` ON `levels` (`iteration_id`, `week`);

ALTER TABLE `team_progress` ADD COLUMN `total_points` integer NOT NULL DEFAULT 0;
ALTER TABLE `team_progress` ADD COLUMN `completed_weeks` text NOT NULL DEFAULT '[]';
ALTER TABLE `team_progress` ADD COLUMN `weekly_stats` text NOT NULL DEFAULT '[]';

CREATE TABLE IF NOT EXISTS `user_week_progress` (
  `id` text PRIMARY KEY NOT NULL,
  `user_id` text NOT NULL,
  `iteration_id` text NOT NULL,
  `week` integer NOT NULL,
  `completed_tasks` text NOT NULL DEFAULT '[]',
  `points_earned` integer NOT NULL DEFAULT 0,
  `is_completed` integer NOT NULL DEFAULT 0,
  `finished_at` integer,
  `key_id` text,
  `title` text,
  FOREIGN KEY (`user_id`) REFERENCES `users`(`id`) ON DELETE CASCADE,
  FOREIGN KEY (`iteration_id`) REFERENCES `iterations`(`id`) ON DELETE CASCADE
);

CREATE UNIQUE INDEX IF NOT EXISTS `user_week_iteration_idx` ON `user_week_progress` (`user_id`, `iteration_id`, `week`);
'
    at BetterSQLiteSession.run (/Users/dmitrii.malakhov/git/evm/api/node_modules/.pnpm/drizzle-orm@0.44.7_better-sqlite3@11.10.0/node_modules/src/sqlite-core/session.ts:271:10)
    at SQLiteSyncDialect.migrate (/Users/dmitrii.malakhov/git/evm/api/node_modules/.pnpm/drizzle-orm@0.44.7_better-sqlite3@11.10.0/node_modules/src/sqlite-core/dialect.ts:849:15)
    ... 4 lines matching cause stack trace ...
    at async asyncRunEntryPointWithESMLoader (node:internal/modules/run_main:116:5) {
  cause: RangeError: The supplied SQL string contains more than one statement
      at Database.prepare (/Users/dmitrii.malakhov/git/evm/api/node_modules/.pnpm/better-sqlite3@11.10.0/node_modules/better-sqlite3/lib/methods/wrappers.js:5:21)
      at BetterSQLiteSession.prepareQuery (/Users/dmitrii.malakhov/git/evm/api/node_modules/.pnpm/drizzle-orm@0.44.7_better-sqlite3@11.10.0/node_modules/src/better-sqlite3/session.ts:60:28)
      at BetterSQLiteSession.prepareOneTimeQuery (/Users/dmitrii.malakhov/git/evm/api/node_modules/.pnpm/drizzle-orm@0.44.7_better-sqlite3@11.10.0/node_modules/src/sqlite-core/session.ts:250:15)
      at BetterSQLiteSession.run (/Users/dmitrii.malakhov/git/evm/api/node_modules/.pnpm/drizzle-orm@0.44.7_better-sqlite3@11.10.0/node_modules/src/sqlite-core/session.ts:269:16)
      at SQLiteSyncDialect.migrate (/Users/dmitrii.malakhov/git/evm/api/node_modules/.pnpm/drizzle-orm@0.44.7_better-sq10:53:06 AM [tsx] change in ./src/routes/admin.ts Rerunning...
c/Users/dmitrii.malakhov/git/evm/api/node_modules/.pnpm/drizzle-orm@0.44.7_better-sqlite3@11.10.0/node_modules/src/sqlite-core/session.ts:271
			throw new DrizzleError({ cause: err, message: `Failed to run the query '${staticQuery.sql}'` });
			      ^


DrizzleError: Failed to run the query 'CREATE TABLE IF NOT EXISTS `iterations` (
  `id` text PRIMARY KEY NOT NULL,
  `name` text NOT NULL,
  `starts_at` integer NOT NULL,
  `ends_at` integer NOT NULL,
  `total_weeks` integer NOT NULL DEFAULT 6,
  `current_week` integer NOT NULL DEFAULT 1
);

ALTER TABLE `levels` ADD C/Users/dmitrii.malakhov/git/evm/api/node_modules/.pnpm/drizzle-orm@0.44.7_better-sqlite3@11.10.0/node_modules/src/sqlite-core/session.ts:271
			throw new DrizzleError({ cause: err, message: `Failed to run the query '${staticQuery.sql}'` });
			      ^


DrizzleError: Failed to run the query 'CREATE TABLE IF NOT EXISTS `iterations` (
  `id` text PRIMARY KEY NOT NULL,
  `name` text NOT NULL,
  `starts_at` integer NOT NULL,
  `ends_at` integer NOT NULL,
  `total_weeks` integer NOT NULL DEFAULT 6,
  `current_week` integer NOT NULL DEFAULT 1
);

ALTER TABLE `levels` ADD COLUMN `iteration_id` text REFERENCES `iterations`(`id`) ON DELETE SET NULL;

DROP INDEX IF EXISTS `levels_week_idx`;
CREATE UNIQUE INDEX IF NOT EXISTS `levels_iteration_week_idx` ON `levels` (`iteration_id`, `week`);

ALTER TABLE `team_progress` ADD COLUMN `total_points` integer NOT NULL DEFAULT 0;
ALTER TABLE `team_progress` ADD COLUMN `completed_weeks` text NOT NULL DEFAULT '[]';
ALTER TABLE `team_progress` ADD COLUMN `weekly_stats` text NOT NULL DEFAULT '[]';

CREATE TABLE IF NOT EXISTS `user_week_progress` (
  `id` text PRIMARY KEY NOT NULL,
  `user_id` text NOT NULL,
  `iteration_id` text NOT NULL,
  `week` integer NOT NULL,
  `completed_tasks` text NOT NULL DEFAULT '[]',
  `points_earned` integer NOT NULL DEFAULT 0,
  `is_completed` integer NOT NULL DEFAULT 0,
  `finished_at` integer,
  `key_id` text,
  `title` text,
  FOREIGN KEY (`user_id`) REFERENCES `users`(`id`) ON DELETE CASCADE,
  FOREIGN KEY (`iteration_id`) REFERENCES `iterations`(`id`) ON DELETE CASCADE
);

CREATE UNIQUE INDEX IF NOT EXISTS `user_week_iteration_idx` ON `user_week_progress` (`user_id`, `iteration_id`, `week`);
'
    at BetterSQLiteSession.run (/Users/dmitrii.malakhov/git/evm/api/node_modules/.pnpm/drizzle-orm@0.44.7_better-sqlite3@11.10.0/node_modules/src/sqlite-core/session.ts:271:10)
    at SQLiteSyncDialect.migrate (/Users/dmitrii.malakhov/git/evm/api/node_modules/.pnpm/drizzle-orm@0.44.7_better-sqlite3@11.10.0/node_modules/src/sqlite-core/dialect.ts:849:15)
    ... 4 lines matching cause stack trace ...
    at async asyncRunEntryPointWithESMLoader (node:internal/modules/run_main:116:5) {
  cause: RangeError: The supplied SQL string contains more than one statement
      at Database.prepare (/Users/dmitrii.malakhov/git/evm/api/node_modules/.pnpm/better-sqlite3@11.10.0/node_modules/better-sqlite3/lib/methods/wrappers.js:5:21)
      at BetterSQLiteSession.prepareQuery (/Users/dmitrii.malakhov/git/evm/api/node_modules/.pnpm/drizzle-orm@0.44.7_better-sqlite3@11.10.0/node_modules/src/better-sqlite3/session.ts:60:28)
      at BetterSQLiteSession.prepareOneTimeQuery (/Users/dmitrii.malakhov/git/evm/api/node_modules/.pnpm/drizzle-orm@0.44.7_better-sqlite3@11.10.0/node_modules/src/sqlite-core/session.ts:250:15)
      at BetterSQLiteSession.run (/Users/dmitrii.malakhov/git/evm/api/node_modules/.pnpm/drizzle-orm@0.44.7_better-sqlite3@11.10.0/node_modules/src/sqlite-core/session.ts:269:16)
      at SQLiteSyncDialect.migrate (/Users/dmitrii.malakhov/git/evm/api/node_modules/.pnpm/drizzle-orm@0.44.7_better-sq10:53:22 AM [tsx] change in ./src/routes/admin.ts Rerunning...
c/Users/dmitrii.malakhov/git/evm/api/node_modules/.pnpm/drizzle-orm@0.44.7_better-sqlite3@11.10.0/node_modules/src/sqlite-core/session.ts:271
			throw new DrizzleError({ cause: err, message: `Failed to run the query '${staticQuery.sql}'` });
			      ^


DrizzleError: Failed to run the query 'CREATE TABLE IF NOT EXISTS `iterations` (
  `id` text PRIMARY KEY NOT NULL,
  `name` text NOT NULL,
  `starts_at` integer NOT NULL,
  `ends_at` integer NOT NULL,
  `total_weeks` integer NOT NULL DEFAULT 6,
  `current_week` integer NOT NULL DEFAULT 1
);

ALTER TABLE `levels` ADD C/Users/dmitrii.malakhov/git/evm/api/node_modules/.pnpm/drizzle-orm@0.44.7_better-sqlite3@11.10.0/node_modules/src/sqlite-core/session.ts:271
			throw new DrizzleError({ cause: err, message: `Failed to run the query '${staticQuery.sql}'` });
			      ^


DrizzleError: Failed to run the query 'CREATE TABLE IF NOT EXISTS `iterations` (
  `id` text PRIMARY KEY NOT NULL,
  `name` text NOT NULL,
  `starts_at` integer NOT NULL,
  `ends_at` integer NOT NULL,
  `total_weeks` integer NOT NULL DEFAULT 6,
  `current_week` integer NOT NULL DEFAULT 1
);

ALTER TABLE `levels` ADD COLUMN `iteration_id` text REFERENCES `iterations`(`id`) ON DELETE SET NULL;

DROP INDEX IF EXISTS `levels_week_idx`;
CREATE UNIQUE INDEX IF NOT EXISTS `levels_iteration_week_idx` ON `levels` (`iteration_id`, `week`);

ALTER TABLE `team_progress` ADD COLUMN `total_points` integer NOT NULL DEFAULT 0;
ALTER TABLE `team_progress` ADD COLUMN `completed_weeks` text NOT NULL DEFAULT '[]';
ALTER TABLE `team_progress` ADD COLUMN `weekly_stats` text NOT NULL DEFAULT '[]';

CREATE TABLE IF NOT EXISTS `user_week_progress` (
  `id` text PRIMARY KEY NOT NULL,
  `user_id` text NOT NULL,
  `iteration_id` text NOT NULL,
  `week` integer NOT NULL,
  `completed_tasks` text NOT NULL DEFAULT '[]',
  `points_earned` integer NOT NULL DEFAULT 0,
  `is_completed` integer NOT NULL DEFAULT 0,
  `finished_at` integer,
  `key_id` text,
  `title` text,
  FOREIGN KEY (`user_id`) REFERENCES `users`(`id`) ON DELETE CASCADE,
  FOREIGN KEY (`iteration_id`) REFERENCES `iterations`(`id`) ON DELETE CASCADE
);

CREATE UNIQUE INDEX IF NOT EXISTS `user_week_iteration_idx` ON `user_week_progress` (`user_id`, `iteration_id`, `week`);
'
    at BetterSQLiteSession.run (/Users/dmitrii.malakhov/git/evm/api/node_modules/.pnpm/drizzle-orm@0.44.7_better-sqlite3@11.10.0/node_modules/src/sqlite-core/session.ts:271:10)
    at SQLiteSyncDialect.migrate (/Users/dmitrii.malakhov/git/evm/api/node_modules/.pnpm/drizzle-orm@0.44.7_better-sqlite3@11.10.0/node_modules/src/sqlite-core/dialect.ts:849:15)
    ... 4 lines matching cause stack trace ...
    at async asyncRunEntryPointWithESMLoader (node:internal/modules/run_main:116:5) {
  cause: RangeError: The supplied SQL string contains more than one statement
      at Database.prepare (/Users/dmitrii.malakhov/git/evm/api/node_modules/.pnpm/better-sqlite3@11.10.0/node_modules/better-sqlite3/lib/methods/wrappers.js:5:21)
      at BetterSQLiteSession.prepareQuery (/Users/dmitrii.malakhov/git/evm/api/node_modules/.pnpm/drizzle-orm@0.44.7_better-sqlite3@11.10.0/node_modules/src/better-sqlite3/session.ts:60:28)
      at BetterSQLiteSession.prepareOneTimeQuery (/Users/dmitrii.malakhov/git/evm/api/node_modules/.pnpm/drizzle-orm@0.44.7_better-sqlite3@11.10.0/node_modules/src/sqlite-core/session.ts:250:15)
      at BetterSQLiteSession.run (/Users/dmitrii.malakhov/git/evm/api/node_modules/.pnpm/drizzle-orm@0.44.7_better-sqlite3@11.10.0/node_modules/src/sqlite-core/session.ts:269:16)
      at SQLiteSyncDialect.migrate (/Users/dmitrii.malakhov/git/evm/api/node_modules/.pnpm/drizzle-orm@0.44.7_better-sq10:57:41 AM [tsx] change in ./src/routes/admin.ts Rerunning...
c/Users/dmitrii.malakhov/git/evm/api/node_modules/.pnpm/drizzle-orm@0.44.7_better-sqlite3@11.10.0/node_modules/src/sqlite-core/session.ts:271
			throw new DrizzleError({ cause: err, message: `Failed to run the query '${staticQuery.sql}'` });
			      ^


DrizzleError: Failed to run the query 'CREATE TABLE IF NOT EXISTS `iterations` (
  `id` text PRIMARY KEY NOT NULL,
  `name` text NOT NULL,
  `starts_at` integer NOT NULL,
  `ends_at` integer NOT NULL,
  `total_weeks` integer NOT NULL DEFAULT 6,
  `current_week` integer NOT NULL DEFAULT 1
);

ALTER TABLE `levels` ADD COLUMN `iteration_id` text REFERENCES `iterations`(`id`) ON DELETE SET NULL;

DROP INDEX IF EXISTS `levels_week_idx`;
CREATE UNIQUE INDEX IF NOT EXISTS `levels_iteration_week_idx` ON `levels` (`iteration_id`, `week`);

ALTER TABLE `team_progress` ADD COLUMN `total_points` integer NOT NULL DEFAULT 0;
ALTER TABLE `team_progress` ADD COLUMN `completed_weeks` text NOT NULL DEFAULT '[]';
ALTER TABLE `team_progress` ADD COLUMN `weekly_stats` text NOT NULL DEFAULT '[]';

CREATE TABLE IF NOT EXISTS `user_week_progress` (
  `id` text PRIMARY KEY NOT NULL,
  `user_id` text NOT NULL,
  `iteration_id` text NOT NULL,
  `week` integer NOT NULL,
  `completed_tasks` text NOT NULL DEFAULT '[]',
  `points_earned` integer NOT NULL DEFAULT 0,
  `is_completed` integer NOT NULL DEFAULT 0,
  `finished_at` integer,
  `key_id` text,
  `title` text,
  FOREIGN KEY (`user_id`) REFERENCES `users`(`id`) ON DELETE CASCADE,
  FOREIGN KEY (`iteration_id`) REFERENCES `iterations`(`id`) ON DELETE CASCADE
);

CREATE UNIQUE INDEX IF NOT EXISTS `user_week_iteration_idx` ON `user_week_progress` (`user_id`, `iteration_id`, `week`);
'
    at BetterSQLiteSession.run (/Users/dmitrii.malakhov/git/evm/api/node_modules/.pnpm/drizzle-orm@0.44.7_better-sqlite3@11.10.0/node_modules/src/sqlite-core/session.ts:271:10)
    at SQLiteSyncDialect.migrate (/Users/dmitrii.malakhov/git/evm/api/node_modules/.pnpm/drizzle-orm@0.44.7_better-sqlite3@11.10.0/node_modules/src/sqlite-core/dialect.ts:849:15)
    ... 4 lines matching cause stack trace ...
    at async asyncRunEntryPointWithESMLoader (node:internal/modules/run_main:116:5) {
  cause: RangeError: The supplied SQL string contains more than one statement
      at Database.prepare (/Users/dmitrii.malakhov/git/evm/api/node_modules/.pnpm/better-sqlite3@11.10.0/node_modules/better-sqlite3/lib/methods/wrappers.js:5:21)
      at BetterSQLiteSession.prepareQuery (/Users/dmitrii.malakhov/git/evm/api/node_modules/.pnpm/drizzle-orm@0.44.7_better-sqlite3@11.10.0/node_modules/src/better-sqlite3/session.ts:60:28)
      at BetterSQLiteSession.prepareOneTimeQuery (/Users/dmitrii.malakhov/git/evm/api/node_modules/.pnpm/drizzle-orm@0.44.7_better-sqlite3@11.10.0/node_modules/src/sqlite-core/session.ts:250:15)
      at BetterSQLiteSession.run (/Users/dmitrii.malakhov/git/evm/api/node_modules/.pnpm/drizzle-orm@0.44.7_better-sqlite3@11.10.0/node_modules/src/sqlite-core/session.ts:269:16)
      at SQLiteSyncDialect.migrate (/Users/dmitrii.malakhov/git/evm/api/node_modules/.pnpm/drizzle-orm@0.44.7_better-sqlite3@11.10.0/node_modules/src/sqlite-core/dialect.ts:849:15)
      at migrate (/Users/dmitrii.malakhov/git/evm/api/node_modules/.pnpm/drizzle-orm@0.44.7_better-sqlite3@11.10.0/node_modules/src/better-sqlite3/migrator.ts:10:13)
      at <anonymous> (/Users/dmitrii.malakhov/git/evm/api/src/db/client.ts:42:5)
      at ModuleJob.run (node:internal/modules/esm/module_job:271:25)
      at async onImport.tracePromise.__proto__ (node:internal/modules/esm/loader:578:26)
      at async asyncRunEntryPointWithESMLoader (node:internal/modules/run_main:116:5)
}

Node.js v22.14.0
lite3@11.10.0/node_modules/src/sqlite-core/dialect.ts:849:15)
      at migrate (/Users/dmitrii.malakhov/git/evm/api/node_modules/.pnpm/drizzle-orm@0.44.7_better-sqlite3@11.10.0/node_modules/src/better-sqlite3/migrator.ts:10:13)
      at <anonymous> (/Users/dmitrii.malakhov/git/evm/api/src/db/client.ts:42:5)
      at ModuleJob.run (node:internal/modules/esm/module_job:271:25)
      at async onImport.tracePromise.__proto__ (node:internal/modules/esm/loader:578:26)
      at async asyncRunEntryPointWithESMLoader (node:internal/modules/run_main:116:5)
}

Node.js v22.14.0
